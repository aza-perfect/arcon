{% load custom_tags %}


<style>
    /* === –ï–¥–∏–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –≤—Å–µ—Ö —Å–µ–ª–µ–∫—Ç–æ–≤ Select2 === */
    .select2-container--default .select2-selection--multiple,
    .select2-container--default .select2-selection--single {
      min-height: 40px;         /* 40px */
      padding: 0.25rem 0.75rem;   /* –ø–æ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ —á—É—Ç—å –º–µ–Ω—å—à–µ, –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ –∫–∞–∫ px-3 */
      border: 1px solid #D1D5DB;  /* border-gray-300 */
      border-radius: 0.375rem;    /* rounded-md */
      background-color: #FFFFFF;  /* bg-white */
    }

    /* –£–±–∏—Ä–∞–µ–º –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
    .select2-container--default .select2-selection__rendered {
      line-height: 30px;        /* —á—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª –ø–æ —Ü–µ–Ω—Ç—Ä—É –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ */
      padding: 0;
    }

    /* –°—Ç—Ä–µ–ª–∫–∞ */
    .select2-container--default .select2-selection__arrow {
      height: 30px;
      right: 0.5rem;
    }
    .select2-container--default .select2-selection__arrow b {
      margin-top: 0.7rem;
    }

    /* –°–∞–º–∏ —ç–ª–µ–º–µ–Ω—Ç—ã multiple (—Ç–µ–≥–∏) */
    .select2-container--default .select2-selection--multiple .select2-selection__choice {
      background-color: #E5E7EB;  /* bg-gray-200 */
      border: none;
      color: #374151;             /* text-gray-700 */
      padding: revert!important;
      margin-top: 0.25rem;
      margin-right: 0.25rem;
      border-radius: 0.25rem;     /* rounded */
    }
    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
      margin-right: 0.25rem;
    }
    /* –ü–æ–¥–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–≥–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –≤—ã–±–æ—Ä–∞ Select2 */
    .select2-container--default .select2-selection--multiple .select2-selection__choice {
      padding: 0.25rem 1.5rem 0.25rem 0.5rem;  /* –£–≤–µ–ª–∏—á–µ–Ω—ã –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞ */
      margin: 0.25rem 0.25rem 0.25rem 0;
      background-color: #E5E7EB;              /* bg-gray-200 */
      border: none;
      border-radius: 0.25rem;                 /* rounded */
    }

/* –ü—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∫—Ä–µ—Å—Ç–∏–∫ */
.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
  color: #374151;                        /* text-gray-700 */
}
    .select2-container--default .select2-selection--multiple .select2-selection__choice__remove {
  color: #374151;  /* –£–ª—É—á—à–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç */
  font-size: 1rem;  /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
  margin-right: 2rem;
  cursor: pointer;
  display: flex;
  align-items: center;
}

/* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —ç—Ñ—Ñ–µ–∫—Ç –Ω–∞–≤–µ–¥–µ–Ω–∏—è */
.select2-container--default .select2-selection--multiple .select2-selection__choice__remove:hover {
  color: #1F2937;  /* –ï—â—ë —Ç–µ–º–Ω–µ–µ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
}

/* –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: —É–ª—É—á—à–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç–∞-–∑–∞–ø–æ–ª–Ω–∏—Ç–µ–ª—è */
.select2-container--default .select2-selection__placeholder {
  color: #6B7280;  /* –¢–µ–º–Ω–µ–µ –¥–ª—è –ª—É—á—à–µ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
}
    .select2-selection__choice__display {
        margin-left: 25px
    }
</style>


<!-- === –§–ò–õ–¨–¢–†–´ === -->
<details class="md:open border rounded bg-white p-4 mb-6">
    <summary class="cursor-pointer font-medium text-gray-700">
        üîç Filter
    </summary>
    {% is_filter_m as show_client_filter %}
    <form method="get" class="mt-4 space-y-4 md:space-y-0 md:flex md:space-x-4">
        {% if show_client_filter %}
        <!-- –ö–ª–∏–µ–Ω—Ç -->
        <div class="flex-1">
            <label class="block text-sm font-medium text-gray-600 mb-1">Mijoz</label>
            <select name="client" id="mijoz" multiple>
                {% for c in clients %}
                <option value="{{ c.id }}" {% if c.id in selected_clients %}selected{% endif %}>
                    {{ c.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}
        <!-- –ü—Ä–æ–¥—É–∫—Ç -->
        <div class="flex-1">
            <label class="block text-sm font-medium text-gray-600 mb-1">Mahsulot</label>
            <select name="product" id="product" multiple>
                {% for c in products %}
                <option value="{{ c.id }}" {% if c.id in selected_products %}selected{% endif %}>
                    {{ c.name }}
                </option>
                {% endfor %}
            </select>
        </div>
        {% if show_client_filter %}
        <!-- –ü—Ä–æ–¥–∞–≤–µ—Ü (–¥–ª—è —Å—É–ø–µ—Ä—é–∑–µ—Ä–∞) -->
        <div class="flex-1">
            <label class="block text-sm font-medium text-gray-600 mb-1">Sotuvchi</label>
            <select name="seller" id="seller" multiple>
                <option value="">‚Äî Hammas–∏ ‚Äî</option>
                {% for c in sellers %}
                <option value="{{ c.id }}" {% if c.id in selected_sellers %}selected{% endif %}>
                    {{ c.username }}
                </option>
                {% endfor %}
            </select>
        </div>
        {% endif %}

        <!-- –î–∞—Ç—ã -->
        <div>
            <label class="block text-sm font-medium text-gray-600">Dan</label>
            <input type="date" name="date_from" value="{{ filter.date_from }}"
                   class="mt-1 block w-full rounded border px-3 py-2"/>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-600">Gacha</label>
            <input type="date" name="date_to" value="{{ filter.date_to }}"
                   class="mt-1 block w-full rounded border px-3 py-2"/>
        </div>
        <div class="flex items-end space-x-2">
            <button type="submit"
                    class="w-full md:w-auto bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                Qollash
            </button>
            <a href="{{ request.path }}"
               class="w-full md:w-auto bg-gray-200 text-gray-700 px-4 py-2 rounded hover:bg-gray-300 text-center">
                Sbros
            </a>
        </div>
    </form>
</details>

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
      // –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –≤—Å–µ –≤–∞—à–∏ —Ñ–∏–ª—å—Ç—Ä—É—é—â–∏–µ <select> –ø–æ –∏—Ö id
      const fields = [
        '#mijoz',     // –∫–ª–∏–µ–Ω—Ç
        '#product',   // —Ç–æ–≤–∞—Ä
        '#seller',   // –ø—Ä–æ–¥–∞–≤–µ—Ü
      ];
      fields.forEach(function(selector) {
        const $el = $(selector);
        if (!$el.length) return;
        $el.select2({
          width: '100%',
          dropdownParent: $('body'),
          placeholder: '‚Äî Hammasi ‚Äî',
          allowClear: true,
          selectionCssClass: 'focus:outline-none focus:ring focus:border-blue-500 bg-white text-gray-900',
          dropdownCssClass:  'bg-white rounded-md shadow-lg mt-1 border border-gray-200',
          // –ï—Å–ª–∏ —ç—Ç–æ multiple (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–ª–∏–µ–Ω—Ç –∏–ª–∏ –ø—Ä–æ–¥–∞–≤–µ—Ü), –¥–æ–±–∞–≤—å—Ç–µ multiple: true
        });
      });
    });
</script>
{% endblock %}